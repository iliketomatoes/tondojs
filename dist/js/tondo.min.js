/*! tondo.js - v0.0.1 - 2016-03-16
* https://github.com/iliketomatoes/tondojs
* Copyright (c) 2016 ; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):"object"==typeof module&&module.exports?module.exports=b:a.Tondo=b()}(window,function(){"use strict";function describeArc(a,b,c,d){var e=["M",a-1,b,"a",c,c,0,1,d,1,0].join(" ");return e}function getCirclePerimeter(a){return 2*Math.PI*a}function extend(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof b[c]&&null!==b[c]?a[c]=extend(a[c],b[c]):a[c]=b[c]);return a}function generateGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function debounce(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function turnArrayStringMapIntoObject(target){var kVArr,tmp;return tmp={},target.forEach(function(keyValue,index){kVArr=keyValue.split(":"),kVArr[0]&&(tmp[kVArr[0]]=eval(kVArr[1]))}),tmp}function Tondo(a,b){var c,d,e,f,g={defaultClass:"tondo",customClass:"",tondoUp:{text:"",gap:5,side:"up",startOffset:"50%",textAnchor:"middle",textClass:"",fontSize:"",letterSpacing:""},tondoDown:{text:"",gap:0,side:"down",startOffset:"50%",textAnchor:"middle",textClass:"",fontSize:"",letterSpacing:""}},h=function(a,b,c){return Object.create(TondoModel,{target:{writable:!1,value:a},GUID:{writable:!1,value:b},settings:{writable:!0,value:c},proxy:{writable:!0,value:{}}})},i=function(a){var b,c,d,e,f,h;return h=a.dataset,d={},h.tondoUp&&(e=h.tondoUp.split(";"),b=turnArrayStringMapIntoObject(e),d.tondoUp=b),h.tondoDown&&(f=h.tondoDown.split(";"),c=turnArrayStringMapIntoObject(f),d.tondoDown=c),h.defaultClass&&(d.defaultClass=h.defaultClass),h.customClass&&(d.customClass=h.customClass),extend(g,d)};for(this.instances=[],d=""===a||"undefined"==typeof a?document.querySelectorAll("*[data-tondo]"):document.querySelectorAll(a),c=null,"object"==typeof b&&null!==b&&(c=extend(g,b)),f=0;d[f];){var j=c||i(d[f]);e=generateGUID(),Instances[e]=h(d[f],e,j),Instances[e].init(),this.instances.push(e),f++}}var Instances={},rAF=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,cAF=window.cancelAnimationFrame||window.mozCancelAnimationFrame,TondoModel={init:function(){this.setLayout(),this.setTondo()},getTargetWidth:function(){var a=this.target.clientHeight,b=this.target.clientWidth;return b>=a?a:b},getRadius:function(a){return this.proxy.targetWidth/2+a},getCircles:function(){return[this.settings.tondoUp,this.settings.tondoDown]},getBiggestGap:function(){var a,b=-(1/0),c=this.getCircles();for(var d in c)a=c[d].gap,"down"===c[d].side&&(a+=parseFloat(c[d].fontSize)),a>b&&(b=a);return b},setLayout:function(){var a,b,c,d,e,f,g;a=this.getCircles(),b=document.createDocumentFragment(),c="http://www.w3.org/2000/svg",d="http://www.w3.org/1999/xlink",f=this.settings.defaultClass+" "+this.settings.customClass,e=document.createElementNS(c,"svg"),e.setAttribute("class",f),e.setAttribute("id",this.GUID),g=document.createElementNS(c,"defs");for(var h in a){var i,j,k,l,m,n,o,p;i=this.GUID+"_"+h+"_"+a[h].side+"_path",k=document.createElementNS(c,"path"),k.setAttribute("id",i),g.appendChild(k),l=document.createElementNS(c,"g"),m=document.createElementNS(c,"use"),m.setAttributeNS(d,"href","#"+i),l.appendChild(m),j=this.GUID+"_"+h+"_"+a[h].side+"_textPath",n=document.createElementNS(c,"textPath"),n.setAttributeNS(d,"href","#"+i),n.setAttribute("id",j),n.setAttribute("startOffset",a[h].startOffset),n.setAttribute("text-anchor",a[h].textAnchor),n.setAttribute("letter-spacing",a[h].letterSpacing),o=a[h].text,n.textContent=o,p=document.createElementNS(c,"text"),p.setAttribute("class",a[h].textClass),p.appendChild(n),l.appendChild(p),e.appendChild(g),e.appendChild(l)}b.appendChild(e),this.target.parentNode.appendChild(b)},setTondo:function(){var a,b,c,d,e,f;a=document.getElementById(this.GUID),b=this.getCircles(),c=a.getAttribute("class");for(var g in b){var h,i;h=this.GUID+"_"+g+"_"+b[g].side+"_textPath",i=document.getElementById(h),b[g].fontSize=window.getComputedStyle(i,null).getPropertyValue("font-size")}this.proxy.gap=this.getBiggestGap(),this.proxy.targetWidth=this.getTargetWidth(),d=this.proxy.targetWidth+2*this.proxy.gap,a.setAttribute("width",d),a.setAttribute("height",d),f=this.target.offsetHeight-d,a.style.left=f/2+this.target.offsetLeft+"px",a.style.top=f/2+this.target.offsetTop+"px",e=[0,0,d,d].join(" "),a.setAttribute("viewBox",e);for(var j in b){var k,l,m,n=0;k=this.GUID+"_"+j+"_"+b[j].side+"_path",l=document.getElementById(k),"up"===b[j].side?(m=this.getRadius(b[j].gap),l.setAttribute("d",describeArc(d/2,d-(this.proxy.gap-b[j].gap),m,1))):(b[j].gap<0?(m=this.getRadius(b[j].gap),n=d-2*m-parseFloat(b[j].fontSize)):(m=this.getRadius(b[j].gap+parseFloat(b[j].fontSize)),n=d-2*m),l.setAttribute("d",describeArc(d/2,n,m,0)))}a.setAttribute("class",c+" tondo--loaded")}},Eventie={init:function(){var a=debounce(this.checkTargetsSizeChange,700);window.onresize=a},checkTargetsSizeChange:function(){rAF(function(){for(var a in Instances)Instances[a].setTondo()})}};return Eventie.init(),Tondo});