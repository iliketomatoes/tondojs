/*! tondo.js - v0.0.1 - 2016-03-14
* https://github.com/iliketomatoes/tondojs
* Copyright (c) 2016 ; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b()):"object"==typeof module&&module.exports?module.exports=b():a.Tondo=b()}(window,function(){"use strict";function a(a,b,c,d){var e=["M",a-1,b,"a",c,c,0,1,d,1,0].join(" ");return e}function b(a,c){for(var d in c)c.hasOwnProperty(d)&&("object"==typeof c[d]&&null!==c[d]?a[d]=b(a[d],c[d]):a[d]=c[d]);return a}function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function d(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function e(a,d){var e={defaultClass:"tondo",customClass:"",tondoUp:{text:"",gap:5,side:"up",startOffset:"50%",textAnchor:"middle",textPathClass:"",fontSize:""},tondoDown:{text:"",gap:0,side:"down",startOffset:"50%",textAnchor:"middle",textPathClass:"",fontSize:""}},g=function(a,b,c){return Object.create(h,{target:{writable:!1,value:a},GUID:{writable:!1,value:b},settings:{writable:!0,value:c},proxy:{writable:!0,value:{}}})},i=b(e,d);this.instances=[];for(var j=document.querySelectorAll(a),k=0;j[k];){var l=c();f[l]=g(j[k],l,i),f[l].init(),this.instances.push(l),k++}}var f={},g=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,h=(window.cancelAnimationFrame||window.mozCancelAnimationFrame,{init:function(){this.setLayout(),this.setTondo()},getTargetWidth:function(){var a=this.target.clientHeight,b=this.target.clientWidth;return b>=a?a:b},getRadius:function(a){return this.proxy.targetWidth/2+a},getCircles:function(){return[this.settings.tondoUp,this.settings.tondoDown]},getBiggestGap:function(){var a,b=-(1/0),c=this.getCircles();for(var d in c)a=c[d].gap,"down"===c[d].side&&(a+=parseFloat(c[d].fontSize)),a>b&&(b=a);return b},setLayout:function(){var a,b,c,d,e,f,g;a=this.getCircles(),b=document.createDocumentFragment(),c="http://www.w3.org/2000/svg",d="http://www.w3.org/1999/xlink",f=this.settings.defaultClass+" "+this.settings.customClass,e=document.createElementNS(c,"svg"),e.setAttribute("class",f),e.setAttribute("id",this.GUID),g=document.createElementNS(c,"defs");for(var h in a){var i,j,k,l,m,n,o,p;i=this.GUID+"_"+h+"_"+a[h].side+"_path",k=document.createElementNS(c,"path"),k.setAttribute("id",i),g.appendChild(k),l=document.createElementNS(c,"g"),m=document.createElementNS(c,"use"),m.setAttributeNS(d,"href","#"+i),l.appendChild(m),j=this.GUID+"_"+h+"_"+a[h].side+"_textPath",n=document.createElementNS(c,"textPath"),n.setAttributeNS(d,"href","#"+i),n.setAttribute("id",j),n.setAttribute("startOffset",a[h].startOffset),n.setAttribute("text-anchor",a[h].textAnchor),n.setAttribute("class",a[h].textPathClass),o=a[h].text,n.textContent=o,p=document.createElementNS(c,"text"),p.appendChild(n),l.appendChild(p),e.appendChild(g),e.appendChild(l)}b.appendChild(e),this.target.parentNode.appendChild(b)},setTondo:function(){var b,c,d,e,f,g;b=document.getElementById(this.GUID),c=this.getCircles(),d=b.getAttribute("class");for(var h in c){var i,j;i=this.GUID+"_"+h+"_"+c[h].side+"_textPath",j=document.getElementById(i),c[h].fontSize=window.getComputedStyle(j,null).getPropertyValue("font-size")}this.proxy.gap=this.getBiggestGap(),this.proxy.targetWidth=this.getTargetWidth(),e=this.proxy.targetWidth+2*this.proxy.gap,b.setAttribute("width",e),b.setAttribute("height",e),g=this.target.offsetHeight-e,b.style.left=g/2+this.target.offsetLeft+"px",b.style.top=g/2+this.target.offsetTop+"px",f=[0,0,e,e].join(" "),b.setAttribute("viewBox",f);for(var k in c){var l,m,n,o=0;l=this.GUID+"_"+k+"_"+c[k].side+"_path",m=document.getElementById(l),"up"===c[k].side?(n=this.getRadius(c[k].gap),m.setAttribute("d",a(e/2,e-(this.proxy.gap-c[k].gap),n,1))):(c[k].gap<0?(n=this.getRadius(c[k].gap),o=e-2*n-parseFloat(c[k].fontSize)):(n=this.getRadius(c[k].gap+parseFloat(c[k].fontSize)),o=e-2*n),m.setAttribute("d",a(e/2,o,n,0)))}b.setAttribute("class",d+" tondo--loaded")}}),i={init:function(){var a=d(this.checkTargetsSizeChange,700);window.onresize=a},checkTargetsSizeChange:function(){g(function(){for(var a in f)f[a].setTondo()})}};return i.init(),e});